# ──────────────────────────────────────────────────────────
# Render Blueprint — RxCompute Backend
# Deploy: Push to GitHub → connect repo on Render → auto-deploy
# ──────────────────────────────────────────────────────────

databases:
  - name: rxcompute-db
    plan: free
    databaseName: rx_db
    user: rx_user

services:
  - type: web
    name: rxcompute-api
    runtime: python
    plan: free
    rootDir: Backend
    buildCommand: chmod +x build.sh && ./build.sh
    startCommand: gunicorn main:app --workers 2 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT --timeout 120
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: rxcompute-db
          property: connectionString
      - key: SECRET_KEY
        generateValue: true
      - key: PYTHON_VERSION
        value: "3.11.9"
      - key: FIREBASE_SERVICE_ACCOUNT
        sync: false  # Set manually in Render dashboard (paste service account JSON)
      - key: SMTP_HOST
        value: "smtp.gmail.com"
      - key: SMTP_PORT
        value: "587"
      - key: SMTP_USER
        sync: false  # deepakm7778@gmail.com
      - key: SMTP_PASSWORD
        sync: false  # Gmail app password (not normal login password)
      - key: SMTP_FROM_EMAIL
        value: "deepakm7778@gmail.com"
  - type: cron
    name: rxcompute-daily-refill-reminder
    runtime: python
    plan: free
    rootDir: Backend
    schedule: "30 3 * * *"
    buildCommand: pip install -r requirements.txt
    startCommand: python jobs/daily_refill_reminder.py
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: rxcompute-db
          property: connectionString
      - key: FIREBASE_SERVICE_ACCOUNT
        sync: false